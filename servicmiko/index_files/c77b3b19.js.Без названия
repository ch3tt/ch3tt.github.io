flexbe_cli.entity.setClientJs("modal","PAY",{types:{},pay_id:"",hash:"",onLoad(){this.$content=this.$modal.find(".action-container"),this.start(),flexbe_cli.events.on("pay",(e=>{e&&("init"===e.action?this.start():"success"===e.action&&this.showSuccessAlert(e.withoutPay))}))},onClose(){try{window.history.pushState(null,null,window.location.pathname)}catch(e){}},start(){const e=this.getPayStatus();if(e){switch(e){case"success":this.showSuccessAlert();break;case"fail":this.showFailAlert();break;case"pay":this.getBill()}setTimeout((()=>{flexbe_cli.events.trigger("ui_modal_open",{id:"pay"})}),200)}},getPayStatus(){let e=!1;try{const t=new URL(window.location.href);e=[...t.searchParams.entries()].reduce(((e,[t,a])=>({...e,[t]:a})),{})}catch(e){return console.error(e),!1}return!(!e||!e.pay_id)&&(this.pay_id=e.pay_id,this.hash=e.h,e.pay_status||"pay")},getBillData(e){this.pay_id&&$.ajax({url:"/mod/pay/ajax",type:"GET",dataType:"json",data:{act:"payData",pay_id:this.pay_id,hash:this.hash}}).done((t=>{t.error&&3===t.status?this.showSuccessAlert(!0):"function"==typeof e&&e(t)}))},getBill(){this.pay_id&&!1!==this.pay_id&&this.getBillData((e=>{if(0===e.status)return setTimeout((()=>{flexbe_cli.events.trigger("ui_modal_close",{id:"pay"}),alert(e.error)}),200),!1;this.types=e.pay.support_types,2==+e.pay.pay_status?this.showAlreadyPayed(e.pay):this.cashonly()?this.showCashInstruction(e.pay):this.showBillForm(e.pay)}))},redirectToPayLink(e){"cash"!==e?window.location.href=`/mod/pay/?pay_type=${e}&pay_id=${this.pay_id}&h=${this.hash}`:this.showCashInstruction()},showBillForm(e){const t=Object.keys(this.types);this.renderView("bill");const a=this.$content,s=a.find(".pay-action"),i=a.find(".pay-methods-list-inner"),n=a.find(".component-button"),o={cash:"cash",bank_card:"cards",visa:"visa",mastercard:"mastercard",yandex:"yandex",qiwi:"qiwi",webmoney:"webmoney",webmoney_z:"webmoney",webmoney_u:"webmoney",mobile_megafon:"megafon",mobile_beeline:"bee",mobile_mts:"mts",mobile_tele2:"t2",sberbank:"sberbank",bank:"bank",w1:"w1",ibank_robo:"ibank_robo",yandex_kassa:"yandexkassa",yandexkassa:"yandexkassa",bank_company:"bank_company",paypal:"paypal"},c=t.reduce(((e,t,a)=>{const s=o[t],i=flexbe_cli.locale.tr(`pay.methods.${t}`);return`${e}<label class="item" title="${i}" for="${t}">\n                <input type="radio" name="form[pay_method]" value="${t}" id="${t}" ${0===a?'checked="checked"':""}>\n                <div class="item-inner">\n                        <span class="check"></span>\n\n                        <span class="icon">\n                            <img class="icon-inner" src="/_s/images/theme/res/pay/${s}.svg" />\n                        </span>\n\n                        <span class="item-name font-size-tiny">${i}</span>\n                </div>\n            </label>`}),"");i.html(c),s.find(".title > span.num").text(e.pay_id),s.find(".price").text(flexbe_cli.locale.formatMoney(e.pay_sum)),i.on("click",".item",(e=>(e.preventDefault(),$(e.currentTarget).find("input").prop("checked",!0),n.removeClass("disabled"),!1))),n.on("click",(e=>{const t=i.find("input:checked").val();if(!t)return i.removeClass("shake"),setTimeout((()=>{i.addClass("shake")}),30),!1;flexbe_cli.run.is_mobile&&flexbe_cli.run.is_OSX||$(e.currentTarget).addClass("submitting"),this.redirectToPayLink(t)}))},showCashInstruction(){this.renderView("loading"),$.ajax({url:"/mod/pay/ajax",type:"GET",dataType:"json",data:{act:"selectCash",pay_id:this.pay_id,hash:this.hash}}).done((e=>{e.link_redirect?window.location.href=e.link_redirect:(this.renderView("cash"),this.types.cash&&this.types.cash.instruction&&this.$content.find(".text").html(this.types.cash.instruction))}))},showAlreadyPayed(e){let t="";e.pay_time_done&&"0"!==e.pay_time_done&&e.pay_time_done_formatted&&(t=e.pay_time_done_formatted),this.renderView("already"),this.$content.find(".text > span.num").text(e.pay_id),this.$content.find(".title > span.num").text(e.pay_id),this.$content.find(".sub > span").text(t),this.$content.find(".price").text(flexbe_cli.locale.formatMoney(e.pay_sum))},showSuccessAlert(e=!1){setTimeout((()=>{flexbe_cli.stat.reachGoal(flexbe_cli.stat.getGoal("pay_done"))}),1e3),e?this.renderView("success"):this.renderView("pay_success")},showFailAlert(){this.renderView("fail"),this.getBillData((e=>{const t=this.$content.find(".pay-action");t.find(".title > span.num").text(e.pay.pay_id),t.find(".price").text(flexbe_cli.locale.formatMoney(e.pay.pay_sum)),this.$content.find(".component-button").off("click").on("click",(()=>{this.getBill()}))}))},cashonly(){return this.types.cash&&1===Object.keys(this.types).length},renderView(e){const t=this.$content,a=this.$area.find(`template[data-id=${e}]`)[0];t.attr("data-view",e).html(a.innerHTML)}});

flexbe_cli.entity.setClientJs("element","header_contacts",{components:["icon"],onInit(){this.initNodes(),this.fixDesc()},onUpdate(){this.initNodes(),this.fixDesc()},onMsg(t){"change_contact"===t&&this.fixDesc()},initNodes(){this.$desc=this.$area.find(".element-text--desc"),this.$icon=this.$area.find(".component-icon"),this.$contact=this.$area.find(".element-text--contact")},fixDesc(){if(this.$desc.length&&this.$contact.length&&this.$icon.length){const t=this.$contact[0].offsetHeight,i=this.$icon[0].offsetHeight;if(t>i){const e=t/2-i/2;this.$icon.css("margin-top",`${e}px`)}else this.$icon.css("margin-top","")}}});

flexbe_cli.entity.setClientJs("element","media01",{components:["image","video","slider"]});

flexbe_cli.entity.setClientJs("element","zone",{components:["backgroundElement"],onInit(){this.setMeta()},onUpdate(){this.setMeta()},setMeta(){const i=this.lastViewport,e=this.lastVisibility;this.lastViewport=flexbe_cli.resize.viewportWidth,this.lastVisibility=flexbe_cli.is_admin&&$("body").hasClass("show-hidden"),this.needFixOrder=this.needFixOrder||this.lastViewport!==i||this.lastVisibility!==e},onResize(){this.inScreen&&this.isVisible&&this.fixElementOrder()},fixElementOrder(){if(this.setMeta(),!this.needFixOrder)return;this.needFixOrder=!1;const i=this.$area.find(".elements-list");i.find("[data-hidden]").length&&i.each(((i,e)=>{const t=$(e).find(".element-item--static"),s=t.filter(":visible");t.removeClass("is-first-child is-last-child"),s.first().addClass("is-first-child"),s.last().addClass("is-last-child")}))}});

!function(){class t{get isOnScreen(){if(!this.$tabsList)return!1;const{top:t,height:i}=this.$tabsList[0].getBoundingClientRect();return t>0&&t+i<flexbe_cli.resize.viewportHeight}constructor(t){if(this.inited=!1,this.interacted=!1,this.opts=void 0,this.$area=void 0,this.uidAttr=void 0,this.classContainer=void 0,this.activeUid=void 0,this.$activeTab=void 0,this.$activeSection=void 0,this.$mainContainer=void 0,this.$tabsContainer=void 0,this.$tabsList=void 0,this.$swiperHelper=void 0,this.$tabs=void 0,this.$sections=void 0,this.opts=t,this.$area=t.$area,this.uidAttr=t.uidAttr||"data-tab-uid",this.classContainer=t.classContainer,this.initTabs(),t.activeUid)this.selectTab(t.activeUid);else if(window.location.hash){const t=window.location.hash.replace("#",""),i=$(`._anchor[name="${t}" i]`),e=i.length?i.closest("[data-id]"):$(`[data-id="${t}" i]`),s=i[0]||e[0];s&&this.selectTabFromTarget(s)}this.$area.on("bringIntoView",(t=>this.selectTabFromTarget(t.target)))}initTabs(){if(this.$mainContainer="self"===this.classContainer?this.$area:this.$area.find(this.classContainer),this.$tabsContainer=this.$area.find(".container-tabs"),this.$tabsList=this.$area.find('[role="tablist"]'),this.$swiperHelper=this.$area.find(".tab-swiper-helper"),this.inited=!!this.$tabsList.length,this.inited&&(this.$tabs=this.$tabsList.find('[role="tab"]'),this.$sections=this.$mainContainer.find('[role="tabpanel"]'),this.normalizeLines(),setTimeout((()=>{this.$mainContainer.addClass("main-area--tabs-inited")}),50),this.$tabsContainer.on("click",".tab",(t=>{const i=$(t.currentTarget).closest(`[${this.uidAttr}]`).attr(`${this.uidAttr}`);i&&this.selectTab(i)})),this.$tabsList.on("wheel",(t=>{flexbe_cli.run.is_pointer&&0===t.originalEvent.wheelDeltaX&&0!==t.originalEvent.wheelDeltaY&&(t.preventDefault(),this.$tabsList[0].scrollLeft+=t.originalEvent.wheelDeltaY)})),this.$tabsList.on("touchstart",(()=>{this.interacted=!0,this.destroySwipeAnimation()})),flexbe_cli.is_admin)){let t;this.$tabsContainer.on("mouseenter",".tab",(i=>{1===i.buttons&&document.body.classList.contains("state--in-move")&&(clearTimeout(t),t=setTimeout((()=>{const t=$(i.target).closest(`[${this.uidAttr}]`).attr(`${this.uidAttr}`);this.selectTab(t)}),700))})),this.$tabsContainer.on("mouseleave",".tab",(()=>{clearTimeout(t)}))}}swipeAnimationController(){if(!this.inited)return;const t=this.$tabsList[0]&&this.$tabsList[0].scrollWidth>this.$tabsList[0].clientWidth,i=this.isOnScreen;t&&i?this.initSwiperAnimation():i||this.destroySwipeAnimation()}initSwiperAnimation(){this.$swiperHelper.hasClass("show")||this.interacted||this.$swiperHelper.addClass("show")}destroySwipeAnimation(){this.$swiperHelper.hasClass("show")&&this.$swiperHelper.removeClass("show")}selectTabFromIndex(t){const i=this.$tabs.get(t);this.selectTabFromTarget(i)}selectTabFromTarget(t){const i=$(t).closest(`[${this.uidAttr}]`).attr(`${this.uidAttr}`);this.selectTab(i)}selectTab(t,{force:i}={}){var e,s;if(!t||!i&&this.activeUid===t)return;this.inited||this.initTabs();const a=null!=(e=null==(s=this.$tabs)?void 0:s.filter(`[${this.uidAttr}="${t}"]`))?e:[];if(!a.length)return;const n=this.$sections.filter(".active"),o=n[0]&&n[0].offsetTop,r=this.$sections.filter(`[${this.uidAttr}="${t}"]`);this.scrollToTab(a),this.$tabs.removeClass("active").attr("aria-selected",!1).attr("tabindex",-1),a.addClass("active").attr("aria-selected",!0).attr("tabindex",0),this.$sections.removeClass("active").prop("hidden",!0),r.addClass("active").prop("hidden",!1);const l=r[0]&&r[0].offsetTop;if(this.activeUid=t,this.$activeTab=a,this.$activeSection=r,n[0].dispatchEvent(new CustomEvent("element-become-hidden")),r[0].dispatchEvent(new CustomEvent("element-become-visible")),"function"==typeof this.opts.onSelectTab&&this.opts.onSelectTab({uid:t,$tab:a}),!flexbe_cli.run.is_mobile&&null!=o&&null!=l&&Math.abs(o-l)>0&&"undefined"!=typeof anime){const t=this.$mainContainer,i=o-l;t.css("will-change","transform"),anime({targets:t[0],translateY:[i,0],duration:250,easing:"easeOutCubic",complete:()=>{t.css({transform:"","will-change":""})}})}}normalizeLines(){if(!this.inited)return;let t;const i=this.$tabs;this.$tabsList.find(".tab-spacer").remove(),i.removeClass("first-in-line last-in-line"),i.first().addClass("first-in-line"),i.last().addClass("last-in-line"),i.each(((i,e)=>{t&&t.offsetTop!==e.offsetTop&&($(e).addClass("first-in-line"),$(t).addClass("last-in-line"),$(t).after('<span class="tab-spacer"></span>')),t=e}))}scrollToTab(t){if(!this.inited)return;const i=this.$tabsList,e=i[0].scrollWidth;if(e>i[0].offsetWidth){const s=t[0].offsetLeft,a=t[0].getBoundingClientRect(),n=flexbe_cli.resize.viewportWidth;let o;a.width>n||a.left<20?o=s-20:a.right>n-20&&(o=s-(n-20-a.width)),null!=o&&(o=Math.max(0,Math.min(e-n,o)),i.animate({scrollLeft:o},{duration:250}))}}resetHash(){if(!this.inited)return;String(window.location.hash).replace(/^#{1,2}(tab)?/,"")===this.activeUid&&(flexbe_cli.lockPopstate=!0,window.history.replaceState(null,null,window.location.pathname),flexbe_cli.lockPopstate=!1)}}flexbe_cli.entity.setClientJs("block","BUNDLE",{components:["background"],tabsController:void 0,shouldInitTabs:!0,onUpdate({templateRendered:t,reasonData:i}){t&&(this.shouldInitTabs=!0),["create","copy"].includes(i.source)&&requestAnimationFrame((()=>this.tabsController.selectTabFromIndex(i.to)))},onResize(){this.tabsController&&this.tabsController.normalizeLines()},onBeside(t){t&&this.shouldInitTabs&&this.createTabs()},onScreen(t){this.tabsController&&(t||(this.tabsController.swipeAnimationController(),this.tabsController.resetHash()))},onFocus(t){this.tabsController&&t&&this.tabsController.swipeAnimationController()},createTabs(){this.shouldInitTabs=!1,this.$area.find('[role="tabpanel"]').length?this.tabsController=new t({$area:this.$area,classContainer:".main-area",activeUid:this.selectedTabUid,onSelectTab:({uid:t})=>{this.selectedTabUid=t,this.updateTween()}}):this.tabsController=null}})}();

flexbe_cli.entity.setClientJs("block","FREE",{components:["background"]});

flexbe_cli.entity.setClientJs("block","HEADER",{components:["background"],onLoad(){if(flexbe_cli.is_admin)return;const t=this.$area.attr("data-overlayed"),a=this.$area.attr("data-static-contrast")||this.$area.attr("data-contrast");if(t&&!a){const t=this.$area.nextAll(":visible:not([data-overlayed])").eq(0).attr("data-contrast");t&&(this.$area.attr("data-static-contrast",t),this.$area.attr("data-contrast",t))}}});

flexbe_cli.entity.setClientJs("element","button01",{components:["icon","button"]});

flexbe_cli.entity.setClientJs("element","figure",{components:["image"]});
